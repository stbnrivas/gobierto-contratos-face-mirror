require "test_helper"
require "vcr"
#require "webmock/minitest"

class Face::Dir3EntitiesTest < ActiveSupport::TestCase
  test "default pagination size is 25" do
    assert_equal 25.0, Face::Dir3Entities::PAGINATION_SIZE # 25 is the default pagination for angular app to be unseen
  end

  test "count for level=1 and dir3=E04585801" do
    VCR.use_cassette("number of result for level=1, dir3=E04585801") do
      assert_equal 45, Face::Dir3Entities.count(1,"E04585801")
    end
  end

  test "number of pages for level=1 and dir3=E04585801" do
    VCR.use_cassette("number of pages for level=1, dir3=E04585801") do
      assert_equal 2, Face::Dir3Entities.last_page(1,"E04585801")
    end
  end

  test "process level=1, dir3=E04585801, page=1" do
    VCR.use_cassette("entities for level=1, dir3=E04585801 page=1") do
      expected = [{:id=>58176, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58155, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58156, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58160, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58162, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58138, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58139, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58143, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58137, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58158, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58157, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58177, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58175, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58140, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58174, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58159, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58141, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>33946, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>18611, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>47362, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>45421, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>2628, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58154, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58144, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58142, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}]
      assert_equal expected, Face::Dir3Entities.entities_for(1,"E04585801",1)
    end
  end

  test "process full level=1, dir3=E04585801" do
    VCR.use_cassette("entities for full level=1, dir3=E04585801") do
      expected = [{:id=>2628, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>18611, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>33946, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>45421, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>47362, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58137, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58138, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58139, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58140, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58142, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58143, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58144, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58154, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58155, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58156, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58157, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58158, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58160, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58162, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58175, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58177, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58176, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58141, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58159, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58174, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58178, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58179, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58180, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58181, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58182, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58183, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58184, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58185, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58187, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58194, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58195, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58196, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58197, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58198, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58199, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58200, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58201, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>58998, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>59060, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}, {:id=>59364, :name=>"Ministerio de Asuntos Exteriores y de Cooperación", :administration_level=>1, :dir3=>"E04585801", :nifs=>["S2812001B"], :country_name=>"España", :country_code=>"ES", :import_pending=>true}]
      assert_equal expected, Face::Dir3Entities.entities(1,"E04585801")
    end
  end

end